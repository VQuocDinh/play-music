
let musicList = [
  {
      id: 1,
      src: "http://localhost:3000/play/tai-vi-sao",
      lyric: [
        'Tại vì sao (yeah-eh) cảm xúc kia quay về? (Woah-oh-oh-oh)',
        'Là tại ai (yeah) đã khiến anh như vậy? (No-oh-oh)',
        'Một điều mà anh đã biết trước rằng là chỉ cần còn khoảng cách sẽ không thấy nhớ nhau',
        'Nhưng mà em đã lỡ lưu son của em (yeah) lên bức tranh anh tô màu',
        'Vậy thì giờ anh muốn ở bên em thật lâu bởi vì nàng là người làm trái tim anh thấy bớt đau',
        'Baby, em cứ giữ đi anh không cần đâu (woah-oh-oh-woah-oh)',
        'Và young boy cô đơn anh cũng muốn được yêu (okay)',
        'Baby, tin anh đi, anh không nói điêu',
        'Đề nghị nàng hãy bỏ ngay đi cho anh thói kiêu',
        'Và lắng nghe con tim anh nếu muốn được chiều',
        'Và nếu em là fire thì anh là nước',
        'Bởi vì khi ta gặp nhau thì ta sẽ dập nhau',
        'Cùng trao nhau tình yêu qua nụ hôn thật lâu',
        'Làm phai đi vệt son anh không muốn đậm màu',
        'Và đếm ba con số one, two, three',
        'Và nếu em không vui thì em cứ đi',
        'Vậy anh không muốn giữ đâu, anh ngu gì',
        'Và cũng đừng gọi tìm anh lúc em thấy suy',
        'Vì anh vẫn okay khi anh một mình',
        'Kiểm soát được tâm trí khi anh nhớ em',
        'Và giờ thì anh đã biết cách yêu bản thân mình',
        'Để không một lần nào lỡ hẹn',
        'Sẽ có những lúc anh đi quên lối về',
        'Thì liệu nàng còn vẫn muốn nắm lấy tay anh?',
        'Chỉ cần vài vệt son lướt lên trên đôi môi kề',
        'Cảm xúc ấy cứ thế vây quanh',
        'Bước xuống dưới phố khi không còn bóng người',
        'Bởi vì anh đi lang thang khi cô đơn lẻ loi',
        'Vào màn trời đêm đen ngỡ rằng em thấy rồi (oh-oh-oh-oh)',
        'Tại vì sao (tại vì sao, yeah) cảm xúc kia quay về? (Cảm xúc ấy, woah-oh-oh-oh)',
        'Vậy là tại ai (là tại ai, yeah) đã khiến anh như vậy? (Khiến anh như vậy, woah-oh-oh-oh)',
        'Có nuối tiếc khi...',
        'Em cứ đổ tại duyên số cho anh được chạm mặt',
        'Nếu biết sẽ đau khi thật lòng',
        'Liệu có vì một hình bóng mà đem lòng tin vào tình yêu phai màu?',
        'Bởi vì em (em, em), mắt em (mắt em)',
        'Chỉ toàn là màu xanh của tình yêu làm cho anh lại tưởng đại dương bên thềm (ooh-ooh, yeah)',
        'OK, khi (khi) thấy em (thấy em)',
        'Là cảm xúc chạm vào nhau vì muốn tận hưởng ngày trôi êm đềm',
        '(Có nuối tiếc khi...)',
        'Và nếu anh biết trước anh đã chẳng như thế',
        'Yeah baby, em không thích những thứ sâu cay',
        'But I thought that you were my baby',
        'Ta đã cùng nhau mơ về thứ sau này',
        'Và nếu anh biết trước anh sẽ không như thế',
        'Liệu em có còn giữ được niềm tin',
        'Để anh không còn lang thang đi kiếm tìm?',
        'Để đời mình được dựng thành một cuốn phim?',
        'Quãng ngày buồn',
        'Và có lẽ anh đã hơi dại dột',
        'Baby, anh hơi ngại rồi',
        'Chắc có lẽ anh tém lại thôi',
        'Bởi vì nàng là người thật đáng chờ đợi',
        'Em ơi, hãy mau mở lời',
        'Cho qua đi niềm đau ở đời',
        'Sao giờ đây con tim vỡ đôi?',
        'Tại vì sao (tại vì sao, yeah) cảm xúc kia quay về? (Woah-oh-oh-oh)',
        'Vậy là tại ai (là tại ai, yeah) đã khiến anh như vậy? (Khiến anh như vậy, woah-oh-oh-oh)',
        'Tại vì sao (tại vì sao, yeah, ooh-ooh-ooh-ooh) cảm xúc kia quay về? (Cảm xúc kia quay về, woah-oh-oh-oh)',
        'Vậy là tại ai (là tại ai, yeah) đã khiến anh như vậy? (Woah-oh-oh-oh)',
        'Sẽ có phút giây gần nhau',
        'Sẽ có phút giây gần nhau (phút giây)',
        'Ooh-ooh-ooh-ooh-ooh-ooh',
    ],
            
    },
  {
    id:2,
    src: "http://localhost:3000/play/tay-lai-pro",
    lyric: [
      'Chỉ một đêm nữa thôi',
      'Chỉ một đêm nữa thôi',
      'Chỉ một đêm nữa thôi',
      '(Louder, louder)',
      'Chỉ một đêm nữa thôi',
      'Lướt đi hơi nhanh trên con xe không phanh, đôi khi lòng mình lẻ loi',
      'Âm thanh vang lên ngay ở trong tai nghe, và tình yêu thì đã lên ngôi',
      'Nhìn đêm trôi gần sát bên tôi, chạm vào em và đưa sát lên môi',
      'Mọi buồn đau rồi sẽ quên thôi, yeah',
      'Là tại vì hình bóng của em giờ đang ở trong đầu (yeah, yeah, yeah)',
      'Và anh đã thức biết bao nhiêu là đêm dài mong cầu (yeah, yeah, yeah)',
      'Không cần phải nói mà sao vẫn cứ hiểu thấu lòng nhau (yeah)',
      'Same frequency, I don\'t wanna let you go',
      'Yeah, anh không muốn thức dậy (chỉ một đêm nữa thôi)',
      'Yeah, anh muốn chìm trong đôi mắt nàng (chỉ một đêm nữa thôi)',
      'Cạm bẫy vẫn đang xung quanh em (chỉ một đêm nữa thôi)',
      'But you got it, got it, got it, girl (one, two, three, go, okay)',
      'DCOD life, yeah, chân em mang Nike Low, yeah',
      'You gotta pick a side, yeah, eeny, miny, moe',
      'Mình cùng ngồi ngắm trăng tàn ở Sài Gòn hai giờ đêm (gad damn)',
      'Henni làm mắt ai mờ thêm, yeah, sau đêm nay xem là ai ở bên',
      'Cuốn một điếu thật to (yeah), bọn anh châm với Thành Draw (yeah)',
      'Bọn anh muốn có thật là nhiều tiền (woah), and we\'re gon\' make some more (yeah)',
      'A-C-I-D, gang, gang, 350 (350)',
      'Lúc đó nhìn em thật đẹp, that\'s everything I know',
      'Rồi mình xuống phố khi đang lên đồ, bầu trời nhiều sao mà đêm nay vẫn tối đen',
      'Nào là cạm bẫy, nào là thiên đường, nhưng mà tại sao trong tim anh có mỗi em',
      'Và chẳng còn biết được đâu là đêm và ngày, nếu cứ tiếp tục trên đà này',
      'I\'m so gonna fucking, fucking, fucking, fucking, fucking, fall in love with you',
      'Yeah, anh không muốn thức dậy (chỉ một đêm nữa thôi)',
      'Yeah, anh muốn chìm trong đôi mắt nàng (chỉ một đêm nữa thôi)',
      'Cạm bẫy vẫn đang xung quanh em (chỉ một đêm nữa thôi)',
      'But you got it, got it, got it, girl (yeah)',
      'Cho em nắm tay anh một chút được không? (Pretty boy)',
      'Những điều sau đây xin phép được nói thật lòng (tell me, baby)',
      'Em không chắc em đang cảm thấy điều gì nhưng mà nhớ anh',
      'Chỉ muốn thấy anh ngay ở bên cạnh (I wanna see you right here)',
      'You got me trippin\' như bị rơi vào tròng (yeah, yeah, trippin\', trippin\')',
      'Nhưng em không thấy bản thân mình đang đề phòng, no',
      'You make me feel safe, rằng mọi thứ sẽ okay khi ở trong vòng tay anh, yeah',
      'Em cũng không muốn thức dậy (yeah, anh cũng không muốn thức dậy)',
      'Mặc kệ thời gian để nó chảy (mặc kệ thời gian đi baby)',
      'Xung quanh là bao nhiêu cạm bẫy',
      'But we got it, yeah',
  ],
  },
  {
    id:3,
    src: "http://localhost:3000/play/rolling-down",
    lyric:[ {time: 71,line: " kể chuyện làm nhà trên bản và nếu như mà"},
            {time: 2, line : "lên  lời bài hát "},
            {time: 3, line : "fbjsfskf"},
            {time: 4, line : "fbjsfskf"},
            {time: 5, line : "fbjsfskf"},
            {time: 6, line : "fbjsfskf"}
            


    ],
  }, {
    id:4,
    src: "http://localhost:3000/play/nguoi-duoc-chon",
  }, {
    id:5,
    src: "http://localhost:3000/play/ai-cung-co-the-la-quan-quan",
  }, {
    id:6,
    src: "http://localhost:3000/play/teeth",
  },
  {
    id:7,
    src: "http://localhost:3000/play/mien-che",
  },
  {
    id:8,
    src: "http://localhost:3000/play/making-my-way-son-tung-m-tp",
  },
  {
    id:9,
    src :"http://localhost:3000/play/TheresNoOneAtAll-SonTungMTP-7583837",
  }
  ];

  
 window.addEventListener("load", () => {
  let musicIndex = 1;
  loadMusic(musicIndex);
  playingNow();
  
})



//Khai báo biến
const mediaListELe = document.querySelector(".media-list");
const addPlayListEle = document.getElementById("add-playlist");
const ModalEle = document.querySelector(".modal");
const Modal2Ele = document.querySelector(".modal-2");
const heartEle = document.querySelectorAll(".heart");
// test
const mainAudio = document.getElementById("main-audio");
const wrapper = document.querySelector(".main-page"),
volumeBtn = document.querySelector(".volume-btn"),
 lyricsBox = document.querySelector(".music-lyric"),
lyrics = document.querySelector(".lyrics"),
lyricsBtn = document.querySelector(".lyrics-details_btn");



document.addEventListener("DOMContentLoaded", function() {
  const playPauseBtn = document.querySelector('.play-pause');
  playPauseBtn.addEventListener("click", () => {
      const isMusicPaused = wrapper.classList.contains("paused");
      isMusicPaused ? pauseMusic() : playMusic();
      playingNow();
  });
});
//  click vào phần tưe khi hiện ra thẻ div

function clicked(element) {
  let getLiIndex = element.getAttribute("li-index");
  musicIndex = getLiIndex;
  loadMusic(musicIndex);
  playMusic();
  playingNow();
  
}

function clicked2(element) {
  let getLyric = element.getAttribute("li1");
  lyric = getLyric;
  loadMusic(lyric);
  
}

function pauseMusic() {
  const playPauseBtn = document.querySelector('.play-pause');
  wrapper.classList.remove("paused");
  playPauseBtn.querySelector("i").innerText = "pause";
  mainAudio.pause();
}



// play

function playMusic() {
  const mainAudio = document.getElementById("main-audio");
  const playPauseBtn = document.querySelector('.play-pause');
  wrapper.classList.add("paused");
  playPauseBtn.querySelector("i").innerText = "play_arrow";
  mainAudio.play();
}

  
function loadMusic(indexNumb) { 
  // musicName.innerText = musicList[indexNumb - 1].name;
  // musicName.setAttribute("title", musicList[indexNumb - 1].name);
  // musicArtist.innerText = musicList[indexNumb - 1].artist;
  const mainAudio = document.getElementById("main-audio");
  mainAudio.src = musicList[indexNumb - 1].src;
}
function loadLyic(lyric) {
  const textContainer = document.querySelector('.lyrics');
  textContainer.li =lyric;
}


function playingNow() {
  const divList = document.querySelector(".media-list");
  let musicIndex = 1;
  const allLiTag = divList.querySelectorAll("div");
  allLiTag.forEach(function(li, index) {
      let audioTag = li.querySelector(".audio-duration");
      if (allLiTag[index].classList.contains("playing")) {
          allLiTag[index].classList.remove("playing");
          let adDuration = audioTag.getAttribute("t-duration");
          audioTag.innerText = adDuration;
      }
      if (allLiTag[index].getAttribute("li-index") == musicIndex) {
          allLiTag[index].classList.add("playing");
      }
      allLiTag[index].setAttribute("onclick", "clicked(this)" ,"clicked2(this")
  })  
}  

// lyric
document.addEventListener("DOMContentLoaded", function() {
const textContainer = document.querySelector(".lyrics"),
lyricsBtn = document.querySelector(".lyrics-details_btn");
lyricsBtn.addEventListener("click", () => {
   lyricsBox.classList.toggle("show");
   lyricsBox.classList.contains("show") ? lyricsBtn.style.color = "white" : lyricsBtn.style.color = "white";
   wrapper.classList.toggle("expand");
  })
})

//  Nut cho bài tiếp theo và lùi lại

document.addEventListener("DOMContentLoaded", function() {
  
  const prevBtn = document.querySelector(".backward");
  const nextBtn = document.querySelector(".forward");

      nextBtn.addEventListener("click", () => {
          nextMusic();
          console.log("Play/Pause button clicked");
      });

      prevBtn.addEventListener("click", () => {
          prevMusic();
      });

});


function nextMusic() {
  musicIndex++;
  if (musicIndex > musicList.length) musicIndex = 1;
  loadMusic(musicIndex);
  playMusic();
  playingNow();
}

function prevMusic() {
  musicIndex--;
  if (musicIndex < 1) musicIndex = musicList.length;
  loadMusic(musicIndex);
  playMusic();
  playingNow();
}


// nút Replay
document.addEventListener("DOMContentLoaded", function() {
  const repeatBtn = document.getElementById("repeat-plist");

  repeatBtn.addEventListener("click", () => {
    let getText = repeatBtn.innerText;

    switch (getText) {
      case "repeat":
        repeatBtn.innerText = "repeat_one";
        repeatBtn.setAttribute("title", "Song looped");
        break;
      case "repeat_one":
        repeatBtn.innerText = "shuffle";
        repeatBtn.setAttribute("title", "Playback shuffle");
        break;
      case "shuffle":
        repeatBtn.innerText = "repeat";
        repeatBtn.setAttribute("title", "Playlist looped");
        break;
    }
  });
});

mainAudio.addEventListener("ended", () => {
  const repeatBtn = document.getElementById("repeat-plist");
  let getText = repeatBtn.innerText;
  switch(getText) {
      case "repeat":
          nextMusic();
          break;
      case "repeat_one":
          mainAudio.currentTime = 0;
          loadMusic(musicIndex);
          playMusic();
          break;
      case "shuffle":
          let randIndex = Math.floor((Math.random() * musicList.length) + 1);
          do {
              randIndex = Math.floor((Math.random() * musicList.length) + 1);
          } while(musicIndex == randIndex)
          musicIndex = randIndex;
          loadMusic(musicIndex);
          playMusic();
          playingNow();
          break;
  }
})


document.addEventListener("DOMContentLoaded", function() {
  let isMuted = false;
  const volumeBtn = document.querySelector(".volume-btn"),
  volumeRangeInput = document.getElementById("volume_input");
  
  volumeBtn.addEventListener("click", () => {
    isMuted = !isMuted;
    let currentVolume = Number(volumeRangeInput.value) / 100;
    if(isMuted) {
        volumeBtn.textContent = "volume_off";
        mainAudio.volume = 0;
    } else {
        volumeBtn.textContent = "volume_up";
        mainAudio.volume = currentVolume;
        changeIconVolume(currentVolume);
    }
  })
});
// volume-btn


function changeIconVolume(volumeValue) {

  if (volumeValue > 0.5 && volumeValue <= 1) {
      volumeBtn.textContent = "volume_up";
  } else if (volumeValue > 0 && volumeValue <= 0.5) {
      volumeBtn.textContent = "volume_down";
  } else {
      volumeBtn.textContent = "volume_mute";
  }
}

// Khu chứa thanh time.
document.addEventListener("DOMContentLoaded", function() {
const progressArea = document.querySelector(".progress-area");

progressArea.addEventListener("click", (e) => {
  let progressWidthVal = progressArea.clientWidth;
  let clickedOffSetX = e.offsetX;
  let songDuration = mainAudio.duration;
  mainAudio.currentTime = (clickedOffSetX / progressWidthVal) * songDuration;
});
});

document.addEventListener("DOMContentLoaded", function() {
  const mainAudio = document.getElementById("main-audio");
  const progressBar = document.querySelector(".progress-bar");
  const musicCurrentTime = document.querySelector(".current");
  const musicDuration = document.querySelector(".duration");

  mainAudio.addEventListener("timeupdate", (e) => {
    const currentTime = e.target.currentTime;
    const duration = e.target.duration;
    let progressBarWidth = (currentTime / duration) * 100;
    progressBar.style.width = `${progressBarWidth}%`;

    let currentMin = Math.floor(currentTime / 60);
    let currentSec = Math.floor(currentTime % 60);
    if (currentSec < 10) {
      currentSec = `0${currentSec}`;
    }
    musicCurrentTime.innerText = `${currentMin}:${currentSec}`;
  });

  mainAudio.addEventListener("loadeddata", () => {
    let audioDuration = mainAudio.duration;
    let totalMin = Math.floor(audioDuration / 60);
    let totalSec = Math.floor(audioDuration % 60);
    if (totalSec < 10) {
      totalSec = `0${totalSec}`;
    }
    musicDuration.innerText = `${totalMin}:${totalSec}`;
  });
});
